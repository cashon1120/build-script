#!/usr/bin/env node
import{execSync as e}from"child_process";import s from"inquirer";import o from"chalk";const n={cloud:{label:"运营平台",name:"vrm_cs_new",distPath:"/Users/ymhx/Documents/vrm_cs_new/dist"},zsmx:{label:"中升铭行",name:"vrm_new_zsmx",distPath:"/Users/ymhx/Documents/vrm_new_zsmx/dist"},qtdp:{label:"前台大屏",name:"vrm_reception",DIST_PATH:"/Users/ymhx/Documents/vrm_big_screen_new/dist"}};!function(){let t="",r="";s.prompt([{type:"rawlist",name:"打包项目",message:"请选择打包项目",choices:Object.keys(n).map((e=>n[e].label))}]).then((m=>{Object.keys(n).map((e=>{n[e].label===m["打包项目"]&&(t=e)})),s.prompt([{type:"input",name:"版本号",message:"请输入版本号(测试环境:dev, 开发环境: 1.0.xx.xxxx)"}]).then((s=>{const m=s["版本号"];if(!m)return void console.log(o.red("请输入版本号"));var l;if(r="dev"===(l=m)?"dev":4!==l.split(".").length?"":l,!r)return void console.log(o.red("版本号格式不正确, 如: 1.0.xx.xxxx"));const c=n[t];console.log(o.green(`打包信息: ${c.label} - ${r}`)),console.log("执行命令========================>"),async function(){const s=`docker build -f /Users/ymhx/Documents/build/build.Dockerfile -t emhes/${c.name}:${r} ${c.distPath}`;console.log(o.blue(`${s} ...`)),await e(`${s}`);const n=`docker tag emhes/${c.name}:${r} harbor.emhes.cn:1080/platform/${c.name}:${r}`;console.log(o.blue(`${n} ...`)),await e(n);const t=`docker push harbor.emhes.cn:1080/platform/${c.name}:${r}`;console.log(o.blue(`${t} ...`)),await e(t),console.log(o.green("执行完成, 查看镜像: https://harbor.emhes.cn:1080, 发布版本: https://serverweb.emhes.cn/#/containers"))}()}))}))}();
