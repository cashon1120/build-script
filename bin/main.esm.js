#!/usr/bin/env node
import{execSync as e}from"child_process";import o from"fs";import s from"inquirer";import t from"chalk";const n={cloud:{label:"运营平台",name:"vrm_cs_new",distPath:"/Users/ymhx/Documents/vrm_cs_new/dist"},zsmx:{label:"中升铭行",name:"vrm_new_zsmx",distPath:"/Users/ymhx/Documents/vrm_new_zsmx/dist"},qtdp:{label:"前台大屏",name:"vrm_reception",distPath:"/Users/ymhx/Documents/vrm_big_screen_new/dist"},wx:{label:"亿盟公众号",name:"vrm_wx",distPath:"/Users/ymhx/Documents/vrm_login/dist"}};!function(){let l="",r="";s.prompt([{type:"rawlist",name:"打包项目",message:"请选择打包项目",choices:Object.keys(n).map((e=>n[e].label))}]).then((m=>{Object.keys(n).map((e=>{n[e].label===m["打包项目"]&&(l=e)})),s.prompt([{type:"input",name:"版本号",message:"请输入版本号(测试环境:dev, 开发环境: 1.0.xx.xxxx)"}]).then((s=>{const m=s["版本号"];if(!m)return void console.log(t.red("请输入版本号"));var c;if(r="dev"===(c=m)?"dev":4!==c.split(".").length?"":c,!r)return void console.log(t.red("版本号格式不正确, 如: 1.0.xx.xxxx"));const a=n[l];console.log(t.green(`打包信息: ${a.label} - ${r}`)),console.log("projectKey: "+a.distPath),console.log("执行命令========================>"),async function(){await o.copyFileSync("/Users/ymhx/Documents/build/build.conf",a.distPath+"/build.conf"),console.log(t.green(`拷贝 build.conf 至 ${a.distPath}`));const s=`docker build -f /Users/ymhx/Documents/build/build.Dockerfile -t emhes/${a.name}:${r} ${a.distPath}`;console.log(t.blue(`${s} ...`)),await e(`${s}`);const n=`docker tag emhes/${a.name}:${r} harbor.emhes.cn:1080/platform/${a.name}:${r}`;console.log(t.blue(`${n} ...`)),await e(n);const l=`docker push harbor.emhes.cn:1080/platform/${a.name}:${r}`;console.log(t.blue(`${l} ...`)),await e(l),console.log(t.green("执行完成, 查看镜像: https://harbor.emhes.cn:1080, 发布版本: https://serverweb.emhes.cn/#/containers"))}()}))}))}();
