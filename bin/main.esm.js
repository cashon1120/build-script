#!/usr/bin/env node
import e from"fs";import t from"chalk";import s from"inquirer";import{execSync as o}from"child_process";const n=()=>{const e=new Date,t="1.0."+(e.getFullYear().toString().slice(2)+".")+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0");return{name:`正式环境${t}`,value:t}},r={cloud:{label:"运营平台",name:"vrm_cs_new",distPath:"/Users/ymhx/Documents/vrm_cs_new/dist"},zsmx:{label:"中升铭行",name:"vrm_new_zsmx",distPath:"/Users/ymhx/Documents/vrm_new_zsmx/dist"},qtdp:{label:"前台大屏",name:"vrm_reception",distPath:"/Users/ymhx/Documents/vrm_big_screen_new/dist"},wx:{label:"亿盟公众号",name:"vrm_wx",distPath:"/Users/ymhx/Documents/vrm_login/dist"}};!function(){let m="",l={};async function a(){console.log(t.green(`${l.label}: ${m}`)),console.log("执行命令========================>"),e.copyFileSync("/Users/ymhx/Documents/build/build.conf",l.distPath+"/build.conf"),console.log(t.blue(`拷贝 build.conf 至 ${l.distPath}`));const s=`docker build -f /Users/ymhx/Documents/build/build.Dockerfile -t emhes/${l.name}:${m} ${l.distPath}`;console.log(t.blue(`${s} ...`)),o(`${s}`);const n=`docker tag emhes/${l.name}:${m} harbor.emhes.cn:1080/platform/${l.name}:${m}`;console.log(t.blue(`${n} ...`)),o(n);const r=`docker push harbor.emhes.cn:1080/platform/${l.name}:${m}`;console.log(t.blue(`${r} ...`)),o(r),console.log(t.green("执行完成, 查看镜像: https://harbor.emhes.cn:1080, 发布版本: https://serverweb.emhes.cn/#/containers"))}s.prompt([{type:"rawlist",name:"projectName",message:"打包项目",choices:Object.keys(r).map((e=>({key:e,name:r[e].label,value:e})))},{type:"rawlist",name:"versionName",message:"打包版本",choices:[{name:"测试环境(dev)",value:"dev"},n(),"自定义"]}]).then((e=>{l=r[e.projectName];const o=e.versionName;if("自定义"!==o)return m=o,void a();s.prompt([{type:"input",name:"inputVersion",message:"请输入版本号(如: 1.0.xx.xxxx)"}]).then((e=>{const{inputVersion:s}=e;var o;m="dev"===(o=s)?"dev":4!==o.split(".").length?"":o,m?a():console.log(t.red("版本号格式不正确, 如: 1.0.xx.xxxx"))}))}))}();
